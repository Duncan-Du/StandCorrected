<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stand-Corrected</title>
</head>

<style>

.title {
    font-weight: bold;
    text-align: center;
}

.options-container {
    display: flex; /* align children (option boxes) in a row */
    justify-content: space-around; /* adds space around the option boxes */
}

.option {
    margin: 0 30px; /* spacing between the boxes */
    padding: 25px;
    border: 1px solid #000;
    flex: 0 0 45%; /* sets each box to 45% of the container's width */
    box-sizing: border-box; 
}

</style>

<body>
    <div class="header">
        <div class="icon"></div>
        <h1 class="title" style="font-weight: bold;">Welcome to “Stand-Corrected”</h1>
        <p class="subtitle">One user at a time please.</p>
    </div>
    <div class="options-container">
        <div class="option">
            <h3>Option 1:</h3>
            <p>If you would like to be scanned to have your posture corrected, raise your left hand.</p>
        </div>
        <div class="option">
            <h3>Option 2:</h3>
            <p>If you do not wish to be scanned, raise your right hand for general posture-correcting tips.</p>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script>
    var host = "cpsc484-02.stdusr.yale.internal:8888"; // Define the host outside of the objects

    $(document).ready(function () {
        frames.start();
        sp2tx.start();
    });

    var frames = {
        socket: null,

        start: function () {
            var url = "ws://" + host + "/frames";
            this.socket = new WebSocket(url);
            this.socket.onmessage = function (event) {
                frames.processFrame(JSON.parse(event.data));
            };
        },

        processFrame: function (data) {
            if (data.people) {
                for (const person of data.people) {
                    // Process each person's data
                    this.processPerson(person);
                }
            }
        },

        processPerson: function (person) {
            const bodyId = person.body_id;
            const joints = person.joints;
            const shoulderLeft = joints[5]; // Index for SHOULDER_LEFT
            const shoulderRight = joints[12]; // Index for SHOULDER_RIGHT
            const handLeft = joints[8]; // Index for HAND_LEFT
            const handRight = joints[14]; // Index for HAND_RIGHT

            // Check if left hand is raised above the left shoulder
            if (
                handLeft.position.y > shoulderLeft.position.y &&
                handLeft.confidence >= 2
            ) {
                this.selectOption(1, bodyId);
            }
            // Check if right hand is raised above the right shoulder
            else if (
                handRight.position.y > shoulderRight.position.y &&
                handRight.confidence >= 2
            ) {
                this.selectOption(2, bodyId);
            }
        },

        selectOption: function (optionNumber, bodyId) {
            console.log(`Body ID ${bodyId} selected option ${optionNumber}`);
            if (optionNumber === 1) {
                // Option 1 selection
                console.log("Option 1 selected - Left hand raised");
                // Additional actions for Option 1
            } else if (optionNumber === 2) {
                // Option 2 selection
                console.log("Option 2 selected - Right hand raised");
                // Navigate to the general_suggestions.html page
                window.location.href = "general_suggestions.html";
            }
        },
    };

    var sp2tx = {
        socket: null,

        start: function () {
            var url = "ws://" + host + "/sp2tx";
            this.socket = new WebSocket(url);
            this.socket.onmessage = function (event) {
                var text = event.data;
                if (text !== "") {
                    console.log("/sp2tx received: " + text);
                }
            };
        },
    };
    </script>
</body>

</html>